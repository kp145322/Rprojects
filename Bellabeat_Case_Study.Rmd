---
title: "Bellabeat_Case_Study"
author: "KP"
date: "last updated 8/20/2021"
output:
  html_document: default
---

---
title: "Google Data Analytics Certificate case study: Bellabeat fitness tech"
output: html_document
---

## Introduction and background
This is an R Markdown document with the R script I used to process, clean, and analyze data for the Google Data Analytics Certificate case study. I utilized CRAN packages 'tidyverse', 'here', 'skimr', 'janitor', and 'GGally'. 



## Data and limitations
I used FitBit Fitness Tracker Data <https://www.kaggle.com/arashnic/fitbit> (CC0: Public Domain, dataset made available through Mobius<https://www.kaggle.com/arashnic>). This Kaggle data set contains personal fitness tracker from thirty fitbit users, generated by respondents to a survey distributed via Amazon Mechanical Turk between 03.12.2016-05.12.2016. Variation in output represents use of different types of Fitbit trackers and individual self-tracking behaviors and preferences.  

Notes on limitations:

* Our data set is not representative of the general U.S. population; sets are collected only from Fitbit users who voluntarily completed a survey. 

* Our sample size is too small to develop meaningful statistical predictions of consumer behavior. Instead, we will attempt to identify general trends and gain insight to improve Bellabeat products. 



## Installing and loading the tidyverse package

```{r install and load packages}
# install.packages('tidyverse')
  library(tidyverse)
```



## Loading CSV files
We'll create a dataframe named 'daily_activity' by reading in a CSV file. We'll create another data frame, 'sleep_day', for sleep data. CSV file source: <https://www.kaggle.com/arashnic/fitbit>

```{r import csv data}
daily_activity <- read.csv(
"~/CSV Data/fitbit data/Fitabase Data 4.12.16-5.12.16/dailyActivity_merged.csv")

sleep_day <- read.csv(
"~/CSV Data/fitbit data/Fitabase Data 4.12.16-5.12.16/sleepDay_merged.csv")

weight_log <- read.csv(
"~/CSV Data/fitbit data/Fitabase Data 4.12.16-5.12.16/weightLogInfo_merged.csv")
```



## Exploring key tables
Let's take a look at our data frames.

```{r view data frames}
head(daily_activity)
head(sleep_day)
```


Let's take a look at column names.

```{r view column names}
colnames(daily_activity)
colnames(sleep_day)
```

Note: Both data sets contain the 'Id' field. We can use this to merge the frames later.



## Viewing summary statistics for familiarization
How many unique participants are there in each dataframe? 

```{r distinct users}
n_distinct(daily_activity$Id)
n_distinct(sleep_day$Id)
```

Note: sleep_day has 24 unique 'Id' values but daily_activity has 33. This may indicate that some respondents chose not to submit, or don't record, sleep activity data. 


How many observations are there in each data frame?

```{r observations in each data frame}
nrow(daily_activity)
nrow(sleep_day)
```


```{r activity summary statistics}
daily_activity %>%  
  select(TotalSteps,
         TotalDistance,
         SedentaryMinutes,
         Calories) %>% 
  summary() 
```

Notes:

* median steps for users are 7406

* There are a few low outliers with zero-values. Our data set description stated variations are due to user preferences and behaviors. Maybe the user forgot or chose not to wear the device, or maybe the device wasn't charged.


```{r sleep summary statistics}
sleep_day_v2 <- sleep_day %>% 
  mutate('TotalHoursAsleep' = TotalMinutesAsleep/60, 'TotalHoursInBed' = 
  TotalTimeInBed/60, .keep = "unused")

sleep_day_v2 %>%  
  select(TotalSleepRecords,
  TotalHoursAsleep,
  TotalHoursInBed) %>%
  summary()
```
Notes: 

* Converted time asleep and time in bed to hours to make values more intuitive. 

* It looks like someone got <1 hour of sleep one night, and someone else spent over 16 hours in bed. We should investigate those values further. 



## Cleaning our data
We'll calculate a new column for TotalMinutes to quickly see if users wore their charged device for the entire day. 

```{r create new variable for total minutes}
daily_activity_v2 <- daily_activity %>% 
  mutate(TotalMinutes = VeryActiveMinutes + FairlyActiveMinutes + 
  LightlyActiveMinutes + SedentaryMinutes)
```


```{r view total minutes summary}
daily_activity_v2 %>% 
  select(TotalMinutes) %>% 
  summary()
```

Note: It looks like we have some observations where a device was either not worn or not charged
for the entire 24-hour (1440 minute) period. We'll run a filter for observations <= 2 hours of sleep  or <= 720 total minutes (half of one day) after combining data frames so we can see all associated values in one place. 



```{r install and load data cleaning packages}
# install.packages("here")
# install.packages("skimr")
# install.packages("janitor")

library(here)
library(skimr)
library(janitor)
```


Let's look at a more detailed data summary using skim_without_charts() from the skimr package.
```{r detailed summary data}
skim_without_charts(daily_activity_v2)
skim_without_charts(sleep_day)
```

Notes:

* Daily_activity_v2 has one character-type variable, ActivityDate. The rest are numeric. 

* As we saw in our previous data summaryies, standard deviation for TotalSteps is almost as high as the mean value and mean TotalMinutes is below 1440. 

* sleep_day_v2 has one character-type variable, SleepDay, which is actually a variable with combined date and time. We will transform it to match the format of daily_activity_v2$ActivityDate before merging data frames. 



## Merging data frames
```{r change variable names to match for data frame merge}
library(lubridate)

sleep_day_v3 <- sleep_day_v2 %>% 
  mutate(NewSleepDay = substr(sleep_day_v2$SleepDay, 1, 9))
```


```{r trim whitespace and remove redundant variables}
sleep_day_v3$ActivityDate <- trimws(sleep_day_v3$NewSleepDay, which = c("both"),
  whitespace = " ")

sleep_day_v4 <- sleep_day_v3 %>% 
  select(-NewSleepDay, -SleepDay) 
```


```{r merge data frames}
sleep_and_activity <- full_join(daily_activity_v2, sleep_day_v4, all = TRUE)
```


Some of the values in sleep_and_activity have SedentaryMinutes values of 1440 minutes, a value for calories, and no other data. We will assume that these values represent days where Fitbits collected data but were not worn by users, resulting in a base metabolic rate caloric calculation and a reading of 'sedentary' for the entire 24 hours. We will remove these observations to clean the data set. 

```{r filter out observations where Fitbit not used}
sleep_and_activity_v2 <- filter(sleep_and_activity, SedentaryMinutes!=1440)
```


```{r filter to observe outliers}
low_outliers <- sleep_and_activity_v2 %>% 
  filter(TotalHoursAsleep <= 2 | TotalMinutes <= 720) 
head(low_outliers)
```

Note: There are a few values where TotalMinutes are less than 60 and the associated calorie count is high. This might be indicative of users who wore their Fitbit only for the duration of a single workout that day. The vast majority of observations seem to indicate that our survey respondents are wearing their Fitbits for long durations and consistently, rather than using them to track isolated workouts. 


Let's explore this idea:

```{r percentage of observations where Fitbit worn more than half the day}
(nrow(sleep_and_activity_v2[sleep_and_activity_v2$TotalMinutes > 720, ])/ 
   nrow(sleep_and_activity_v2)) * 100
```

Notes: 

* Respondents used their Fitbits for *more than half the day in 97% of reported observations.* 

* These users may stand to benefit from a subscription service and app that combine a user-friendly and visually appealing dashboard for managing data and providing health recommendations. 

* One way to get more data to validate this hypothesis would be through performing additional surveys with targeted questions.  


```{r add a new variable for total active minutes}
sleep_and_activity_v3 <- sleep_and_activity_v2 %>% mutate(TotalActiveMinutes = 
  VeryActiveMinutes + FairlyActiveMinutes + LightlyActiveMinutes)
```



## Plotting explorations and analysis

```{r convert sleep times back into minutes for better graphical comparison}
sleep_and_activity_v4 <- sleep_and_activity_v3 %>% 
  mutate('TotalMinutesAsleep' = TotalHoursAsleep*60, 'TotalMinutesInBed' = 
  TotalHoursInBed*60, .keep = "unused")
```


```{r create corellogram for quick comparison}

# install.packages("GGally")
library(GGally)

segment_sleep_steps_activity <- sleep_and_activity_v4 %>% select(TotalSteps, 
  TotalActiveMinutes, TotalMinutesAsleep, SedentaryMinutes)

ggpairs(
  segment_sleep_steps_activity,
  title = 'Correlation Matrix',
  axisLabels = c("show"),
  labeller = "label_value",
  proportions = "auto",
  shape = ".",
  cardinality_threshold = NULL
  ) + theme_minimal()+
  theme(plot.title = element_text(hjust = 0.5)) 
```

Notes:

* Correlation values are Pearson correlation coefficients

* TotalSteps and TotalActiveMinutes are positively correlated.

* TotalMinutesAsleep and SedentaryMinutes are negatively correlated. This means that as time spent sedentary goes up time spent sleeping generally goes down, but it does not prove causation.



Let's focus on the two strongest correlations we found in the variables we analyzed. We determined that sedentary minutes and sleeping minutes were negatively correlated. 

```{r plot TotalSteps and TotalActiveMinutes}
sleep_and_activity_v4 %>% 
  ggplot(mapping = aes(x=TotalActiveMinutes, y=TotalSteps)) + geom_point() + 
  geom_smooth(method='lm', se=FALSE) + theme_minimal() + 
  labs(title="Fitbit Data: Active Minutes vs. Total Steps", subtitle=
      "Sample of 30 Users", caption =
      "Data collected via Amazon Mechanical Turk 03.12.2016-05.12.2016") +
  theme(plot.title = element_text(hjust = 0.5), plot.subtitle = 
        element_text(hjust = 0.5))
```


```{r plot sedentary minutes and minutes asleep}
sleep_and_activity_v4 %>% 
  ggplot(mapping = aes(x=SedentaryMinutes, y=TotalMinutesAsleep)) + 
  geom_point() + geom_smooth(method="lm", se=FALSE) + theme_minimal() +  
  labs(title="Fitbit Data: Sedentary Minutes vs. Minutes Asleep", subtitle=
  "Sample of 30 Users",
  caption="Data collected via Amazon Mechanical Turk 03.12.2016-05.12.2016")+
  theme(plot.title = element_text(hjust = 0.5), plot.subtitle = 
  element_text(hjust = 0.5))
```


Let's take a look at the relationship between sedentary time, sleep time, and BMI for respondents. To do this we'll need to merge in our weight_log dataframe. 

```{r merge weight_log}
bmi_data <- weight_log %>%  
  group_by(Id) %>% 
  summarize(BMI = mean(BMI))

activity_bmi_sleep <- full_join(sleep_and_activity_v4, bmi_data)

unique_id_bmi <- activity_bmi_sleep %>%  
  select(Id, BMI, SedentaryMinutes) %>% 
  group_by(Id) %>% 
  summarize(user_bmi = mean(BMI), user_sedentary_minutes = mean(SedentaryMinutes)) %>% 
  na.omit()
  


unique_id_bmi %>% 
  ggplot() + geom_point(mapping=aes(x=user_sedentary_minutes, y=user_bmi, 
                                    size=user_bmi)) +theme_minimal() +
  labs(title="Fitbit Users: Sedentary Minutes vs. BMI", subtitle=
  "Sample of 8 Users",
  caption="Data collected via Amazon Mechanical Turk 03.12.2016-05.12.2016") +
  theme(plot.title = element_text(hjust = 0.5), plot.subtitle = 
  element_text(hjust = 0.5))

```

Note: It turns out there are only 8 unique Id's with corresponding BMI values in the survey results. This sample is probably too small to gain meaningful insight. 

We saw above in 'Merging dataframes: chunk 18, percentage of observations where Fitbit worn more than half the day' that the device was worn for 720 or more minutes out of 1440 minutes in 97% of our survey observations. Let's expand that idea with a histogram showing the distribution of mean daily fitbit utilization proportions for unique user Ids.

```{r}
use_data_histogram <- activity_bmi_sleep %>%  
  select(Id, TotalMinutes, TotalActiveMinutes) %>% 
  group_by(Id) %>% 
  summarize(fitbit_use_ratio = mean(TotalMinutes)/1440, 
  mean_active_minutes = mean(TotalActiveMinutes))

ggplot(data=use_data_histogram) + geom_histogram(mapping=aes
  (x=fitbit_use_ratio), binwidth = 0.2) + expand_limits(x=0) + 
  theme_minimal() + labs(title=
  "Histogram: User Count per fitbit_use_ratio", 
  subtitle="33 users sampled, ratio = TotalMinutes / Day",
  caption="Data collected via Amazon Mechanical Turk 03.12.2016-05.12.2016") +
  theme(plot.title = element_text(hjust = 0.5), plot.subtitle = 
  element_text(hjust = 0.5))
```

Note: The majority of survey respondents used their fitbits for more than half the day, so we can say that the trend *among those surveyed* is to regularly and consistently wear their fitbits and maintain them charged. 



## Summary of insights

* Total steps and total active minutes are relatively strongly correlated. It makes sense that someone who walks more would spend more minutes being active. Total active minutes includes periods of lightly active, fairly active, and very active minutes. 

* Sedentary minutes and sleep time are negatively correlated. This does not prove causation, but we can create some hypotheses to try to identify a causal relationship between these factors, or between a confounding variable and these factors. Some possible hypotheses include: 

  1) People who spend more time sedentary also spend less time active. The lack of physical activity may induce physiological changes resulting     poorer or shorter sleep. 

  2) People who sleep less feel less energetic and are therefore less motivated to perform physical activity, resulting in reduced daily active     minutes.

* Surveyed users utilize their Fitbits consistently throughout the day and regularly across days. We should keep in mind that this data is collected from voluntary survey participants so our sample may be inherently biased towards users who track their fitness data and use their Fitbits regularly.

## Recommendations and next steps

* Conduct surveys with a larger and more representative sample of Fitbit and other fitness tracking device users. Use these results to inform business development; for example, if most users regularly track their data, adding features to the Bellabeat app and online fitness tracking subscription service and marketing them to these users may result in higher subscription rates.

* Survey Bellabeat users to see what functionalities they would like to see in the subscription service, and how their preferences match up to presently offered services

* Attempt to validate the correlation between sedentary time and reduced sleep time. If it holds true in larger data sets, we can use this information to target Bellabeat ads to people who want to get more sleep based on their Google search and social media history. In this case, we would focus on the correlation between more steps and more sleep in ads, and relate how the Bellabeat Leaf and mobile app help users track, analyze, and raise their step count.  

* Survey Bellabeat users to determine how much new users raise their step count after purchasing the Bellabeat Leaf and online subscription, then advertise the result in conjunction with the sedentary time to reduced sleep time correlation. 

 
